class VWindowComponent extends HTMLElement{constructor(){super();this.mouse={x:0,y:0};this.metadata={x:0,y:0,w:860,h:400}}static get observedAttributes(){return["title"]}set title(a){this._title=a;this.header&&(this.updateHeader(),this.setAttribute("title",a))}static removeAllWindowFocus(){document.querySelectorAll("v-window").forEach(a=>{a.removeAttribute("focused")})}connectedCallback(){this.header||(this.setupHeader(),this.setupContent(),this.innerHTML=null,this.appendChild(this.header),this.appendChild(this.content),
this.setupResizer());this.updateMetaData()}updateHeader(){this.header.querySelector("v-window-headline").innerHTML=this._title??"Unknown Window"}attributeChangedCallback(a,d,c){"title"===a&&this._title!==c&&(this.title=c)}setupContent(){this.content=document.createElement("v-window-content");const a=this.children;for(;a.length;)this.content.appendChild(a[0])}setupHeader(){this.header=document.createElement("v-window-header");const a=document.createElement("v-window-headline");this.header.appendChild(a);
this.updateHeader();const d=document.createElement("div");d.classList.add("window-buttons");this.getItems().forEach(c=>{const e=document.createElement("span");e.classList.add("button",c.class??"default");e.innerHTML=c.text;d.appendChild(e);e.addEventListener("click",()=>this.clickWindowButton(c))});this.setupEvents();this.header.appendChild(d)}setupResizer(){const a=this.resizer=document.createElement("v-window-resizer");var d=0,c=0;const e=b=>{this.metadata.w+=b.clientX-d;this.metadata.h+=b.clientY-
c;this.metadata.w=Math.max(this.metadata.w,200);this.metadata.h=Math.max(this.metadata.h,100);this.updateMetaData();b.preventDefault();b.stopPropagation();d=b.clientX;c=b.clientY};this.addMultiListener(a,"mousedown touchstart",b=>{b.preventDefault();b.stopPropagation();this.setAttribute("resizing","1");d=b.clientX;c=b.clientY;this.addMultiListener(window,"mousemove touchmove",e);this.addMultiListener(window,"mouseup touchend",()=>{this.removeAttribute("resizing");this.removeMultiListener(window,"mousemove touchmove",
e)},{once:!0})});this.appendChild(a)}addMultiListener(a,d,c,e={}){d.split(" ").forEach(b=>a.addEventListener(b,c,e))}removeMultiListener(a,d,c,e={}){d.split(" ").forEach(b=>a.removeEventListener(b,c,e))}clickWindowButton(a){return a.cb&&a.cb()}updateMetaData(){this.metadata.x=Math.max(this.metadata.x,0);this.metadata.y=Math.max(this.metadata.y,0);this.style.transform=`translate(${this.metadata.x}px,${this.metadata.y}px)`;this.style.maxWidth=this.metadata.w+"px";this.style.maxHeight=this.metadata.h+
"px";this.removeAttribute("maximized")}setupEvents(){this.addMultiListener(this,"mousedown touchstart",()=>{VWindowComponent.removeAllWindowFocus();this.setAttribute("focused","1")},{passive:!0});this.addMultiListener(this.header,"mousedown touchstart",a=>{a.target.closest(".window-buttons")||(a.preventDefault(),a.stopPropagation(),this.isDragging=!0,this.mouse={x:a.clientX,y:a.clientY},this.setAttribute("resizing","1"),this.addMultiListener(window,"mouseup touchend",d=>{this.isDragging=!1;this.removeAttribute("resizing")},
{once:!0}))});this.addMultiListener(window,"mousemove touchmove",a=>{this.isDragging&&(this.metadata.x+=a.clientX-this.mouse.x,this.metadata.y+=a.clientY-this.mouse.y,this.mouse={x:a.clientX,y:a.clientY},this.updateMetaData())},{passive:!0})}getItems(){return[{class:"fullscreen",text:"&#x26F6;",cb:()=>{this.hasAttribute("maximized")?this.updateMetaData():(this.setAttribute("maximized","true"),this.style.transform="translate(0px,0px)",this.style.maxWidth="100%",this.style.maxHeight="100%")}},{class:"close",
text:"&#x2715;",cb:()=>{this.parentElement.removeChild(this)}}]}}customElements.define("v-window",VWindowComponent);
